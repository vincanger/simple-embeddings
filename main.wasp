app __waspAppName__ {
  wasp: {
    version: "__waspVersion__"
  },
  title: "__waspProjectName__",
  db: { 
    system: PostgreSQL,
    seeds: [
      import { embedSeedScript } from "@server/generateEmbeddings.js",
    ]
  },
  dependencies: [
    ("openai", "3.2.1"),
    ("gpt-3-encoder", "^1.1.4"),
    ("mammoth", "1.5.1"),
    ("pdf-parse", "1.1.1"),
    ("@types/pdf-parse", "1.1.1"),
    ("@pinecone-database/pinecone", "0.1.6"),
  ],
}

entity TextChunk {=psl
  id              Int         @id @default(autoincrement())
  title           String
  content         String
  tokenAmount     Int
  parentFile      ParentFile? @relation(fields: [parentFileTitle], references: [title])
  parentFileTitle String?
psl=}

entity ParentFile {=psl
  id              Int         @id @default(autoincrement())
  title           String      @unique
  textChunks      TextChunk[]
  isComplete      Boolean     @default(false)
  dateEmbedded    DateTime    @default(now())
psl=}

route RootRoute { path: "/", to: MainPage }
page MainPage {
  component: import Main from "@client/MainPage"
}

route ParentFileRoute { path: "/parentfile/:id", to: ParentFilePage }
page ParentFilePage {
  component: import ParentFile from "@client/ParentFilePage"
}

action generateEmbeddings {
  fn: import { generateEmbeddings } from "@server/generateEmbeddings.js",
  entities: [TextChunk, ParentFile]
}

query getEmbeddedFilenames {
  fn: import { getEmbeddedFilenames } from "@server/getEmbeddedFiles.js",
  entities: [ParentFile]
}

query searchEmbeddings {
  fn: import { searchEmbeddings } from "@server/searchEmbeddings.js",
  entities: [TextChunk]
}

query getEmbeddedTextChunk {
  fn: import { getEmbeddedTextChunk } from "@server/getEmbeddedFiles.js",
  entities: [TextChunk, ParentFile]
}